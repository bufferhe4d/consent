\documentclass[11pt]{article}

% cryptocode:
\usepackage [
lambda, % or n
advantage, 
operators, 
sets,
adversary, 
landau,
probability, 
notions,
logic,
ff, 
mm,
primitives, 
events, 
complexity, 
oracles, 
asymptotics, 
keys
]{cryptocode}

\usepackage{amsthm}
\usepackage[colorinlistoftodos,prependcaption, textsize=small]{todonotes}
\usepackage{graphicx} % Required for inserting images

\title{Digital Consents}

\begin{document}
\include{macros}
\maketitle
\section{Adaptor Signature Approach}

An adaptor signature scheme with respect to a hard relation R consists of five algorithms defined as follows:

\begin{itemize}
    \item $\tilde{\sigma}\gets pSign(m, \sk, Y):$ takes as input a message $m$, signing key $\sk$ and an instance $Y$. Outputs a presignature $\tilde{\sigma}$
    \item $0/1 \gets pVerify(m, \pk, \tilde{\sigma}, Y):$ takes as input a message $m$, verifying key $\pk$, a presignature $\tilde{\sigma}$ and an instance $Y$. Outputs 1 if $\tilde{\sigma}$ is a valid presignature under $\pk$
    \item $\sigma \gets Adapt(m, \pk, \tilde{\sigma}, y):$ takes as input a message $m$, verifying key $\pk$, a presignature $\tilde{\sigma}$ and a witness $y$. Outputs a full signature $\sigma$.
    \item $y \gets Ext(\sigma, \tilde{\sigma}, Y):$ takes as input a presignature $\tilde{\sigma}$, a full signature $\sigma$ and an instance $Y$. Outputs a witness $y$ such that $(y, Y) \in R$.
\end{itemize}

Note that since pSign and pVerify do not require the knowledge for the witness of R, they can be separated to another party who doesn't know the witness. The main idea is to construct a discrete log instance with the help of $\idm$ that is tied to the $att$ we would like to give consent to.

Let $\mathsf{Gen,Sign, Verify}$ be a signature scheme  and let $\agentsk, \agentsk$ be a keypair for an adaptor signature with respect to discrete logarithm relation. We propose the following consent protocol in Fig. \ref{prot:construction_adapt}.

\begin{figure*}[h!]
\pseudocodeblock[xshift=-70pt] 
{
 \idm(\pk_\idm)  \<\< \client  \<\< \signserv(\dict, \agentsk, \agentpk)\pclb
 \pcintertext[dotted]{Enroll} \\
  \<\< \text{pick } \mathsf{passw} \<\< \\
  % \<\< seed \sample \bin^\secpar \<\< \\
  % \<\< s_\idm \sample PRF(\pseudo, seed) \<\< \\
  \<\< s_\idm \sample \bin^\secpar \<\< \\
  \<\< \texttt{store }  P = s_\idm*\pk_\idm \<\< \\
  \<\< (sk, pk) \gets \mathsf{Gen}(\secparam) \<\< \\
  \< \sendmessageleft{length=1.5cm,top={$s_\idm$}}\<\< \sendmessageright{length=1.5cm,top={$sk, \pseudo$}}\\
  \<\<  \<\< \texttt{store } \dict[\pseudo] = sk\pclb
\pcintertext[dotted]{Consent} \\
  \<\< r \sample \bin^\secpar \<\< \\
  \<\< Q \gets r\cdot H(\pseudo, att) \<\< \\
  \< \sendmessageleft{length=1.5cm,top=$Q$} \<\< \\
  P \gets s_\idm \cdot \pk_\idm \< \<  \<\< \\
  R \gets s_\idm \cdot Q \< \<  \<\< \\
  \pi \gets ZKPok(DLEQ(R,P))  \< \<  \<\< \\
  \< \sendmessageright{length=1.5cm,top={$R$}} \<\< \\
  \<\< \pcif Verify(\pi, Q, R, \pk_\idm, P) \<\< \\
  \<\< \t \pcabort \<\< \\
  \<\< S \gets (1/r)\cdot R \<\< \\
  \< \<\< \sendmessageright{length=1.5cm,top={$(\pseudo, att, S)$}}\\
  \<\<  \<\< \pcif \pseudo \notin \dict\\
  \<\<  \<\< \t \pcabort\\
  \<\<  \<\< H' \gets H(\pseudo, att) \\
  \<\<  \<\< \consent \gets pSign(H', \agentsk, S) \pclb
  \pcintertext[dotted]{Resolve Complaint} \\
   pVrfy(H', \agentpk, \consent, s_\idm\cdot H') \overset{?}{=} 1\< \<\< \sendmessageleft{length=1.5cm,top={$(\consent, H')$}, bottom={\text{to \idm}}}\\
  % \<\<  \<\< \consent \gets \mathsf{Reconstruct}(\{[\consent]_i\}_{i\in [n]})\\
  %\<\<  \<\< e(\consent, \GGhat) \overset{?}{=} e(H(\pseudo, att), P)\\  
}
\caption{Consent Protocol Construction (Simple)}
\label{prot:construction_adapt}
\end{figure*}

\pagebreak
\subsection{Verification to a Third Party (to be read after examining Fig.1)}

If a third party (such as judge) needs to verify the consent, the $\idm$ can burn $s_\idm$ and give it to the judge. The agent provides $H'$ and $\consent$. The judge runs $Adapt(H', \agentpk, \consent, s_\idm)$ to obtain $\sigma$. Then checks $s_\idm \overset{?}{=} Ext(\sigma, \consent, s_\idm\cdot H')$

\subsection{Issues}

\begin{itemize}
    \item The current consent verification process depends on the $\idm$, hence it could be thought of as a notary, which is not ideal for the $\signserv$.
    \item Technically, the agent can launch an independent consent protocol after obtaining $\pseudo$. This exists in our previous approach as well.
\end{itemize}

\end{document}
